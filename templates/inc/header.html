{% load i18n %}
<header
  class="bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700 shadow-lg sticky top-0 z-50 transition-all duration-300 ease-in-out"
  id="main-header"
>
  <div class="container mx-auto px-4 sm:px-6 lg:px-8">
    <!-- Ø±Ø¯ÛŒÙ Ø¨Ø§Ù„Ø§: Ù„ÙˆÚ¯ÙˆØŒ Ù…Ù†ÙˆÛŒ Ú©Ø§Ø±Ø¨Ø±ØŒ Ø§Ù†ØªØ®Ø§Ø¨ Ø²Ø¨Ø§Ù†ØŒ Ø¯Ú©Ù…Ù‡ CTA -->
    <div class="py-4 flex flex-row-reverse items-center justify-between">
      
      <!-- Ù„ÙˆÚ¯Ùˆ + Ù†Ø§Ù… Ø³Ø§ÛŒØª -->
      <a
        href="{% url 'home:main' %}"
        class="flex items-center gap-3 text-2xl md:text-3xl font-extrabold text-gray-900 dark:text-white hover:text-blue-500 dark:hover:text-blue-400 transition-colors duration-300"
      >
        <img
          src="https://ippfa.ir/wp-content/uploads/2024/11/IMG_20241208_094817_166.jpg"
          alt="{% trans 'Ù„ÙˆÚ¯Ùˆ Ú©Ø§Ø±Ø®Ø§Ù†Ù‡ Ù¾Ù„ÛŒâ€ŒØ§ØªÛŒÙ„Ù†' %}"
          class="h-12 w-auto rounded-full border border-gray-300 dark:border-gray-600 shadow-md"
        />
        <span>{% trans "Ú©Ø§Ø±Ø®Ø§Ù†Ù‡ Ù¾Ù„ÛŒâ€ŒØ§ØªÛŒÙ„Ù†" %}</span>
      </a>

      <!-- Ø¨Ø®Ø´â€ŒÙ‡Ø§ÛŒ Ø³Ù…Øª Ø±Ø§Ø³Øª Ø¯Ø³Ú©ØªØ§Ù¾ -->
      <div class="hidden md:flex items-center gap-8">
        <!-- Ù…Ù†ÙˆÛŒ Ú©Ø´ÙˆÛŒÛŒ ÙˆØ±ÙˆØ¯/Ø«Ø¨Øª Ù†Ø§Ù… ÛŒØ§ Ø®Ø±ÙˆØ¬ (Ø¯Ø³Ú©ØªØ§Ù¾) -->
        <div class="relative group">
          {% if user.is_authenticated %}
          <button
            id="userMenuButton"
            class="flex items-center gap-3 bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 px-4 py-2 rounded-lg focus:outline-none transition-all duration-300"
          >
            <img
              src="/path/to/avatar.png"
              alt="Avatar"
              class="w-8 h-8 rounded-full border-2 border-blue-500 dark:border-blue-400"
            />
            <span class="text-gray-800 dark:text-gray-200 font-medium"
              >{% blocktrans %}Ø³Ù„Ø§Ù…ØŒ {{ user.username }}{% endblocktrans %}</span>
            <svg
              class="w-5 h-5 transition-transform duration-300 group-hover:rotate-180"
              id="userDropdownArrow"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M19 9l-7 7-7-7"
              />
            </svg>
          </button>
          <div
            id="userDropdown"
            class="absolute right-0 mt-2 w-56 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl shadow-2xl flex-col overflow-hidden opacity-0 scale-95 transform origin-top transition-all duration-300 group-hover:opacity-100 group-hover:scale-100 pointer-events-none group-hover:pointer-events-auto"
          >
            <a
              href="{% url 'accounts:dashboard' %}"
              class="flex items-center gap-3 px-4 py-3 text-gray-800 dark:text-gray-200 bg-blue-50 dark:bg-blue-900 hover:bg-blue-100 dark:hover:bg-blue-800 rounded-t-xl transition-all duration-200"
            >
              {% trans "Ù¾Ù†Ù„ Ú©Ø§Ø±Ø¨Ø±ÛŒ" %}
            </a>
            <form action="{% url 'accounts:logout' %}" method="post">
              {% csrf_token %}
              <button
                type="submit"
                class="w-full flex items-center gap-3 px-4 py-3 text-white bg-red-600 hover:bg-red-500 rounded-b-xl transition-all duration-200"
              >
                {% trans "Ø®Ø±ÙˆØ¬" %}
              </button>
            </form>
          </div>
          {% else %}
          <button
            id="guestMenuButton"
            class="flex items-center gap-3 bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-700 hover:to-blue-600 text-white px-5 py-2 rounded-full font-semibold shadow-md transition-all duration-300 hover:shadow-lg"
          >
            <span>{% trans "Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ" %}</span>
            <svg
              class="w-5 h-5 transition-transform duration-300 group-hover:rotate-180"
              id="guestDropdownArrow"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M19 9l-7 7-7-7"
              />
            </svg>
          </button>
          <div
            id="guestDropdown"
            class="absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl shadow-2xl flex flex-col overflow-hidden opacity-0 scale-95 transform origin-top transition-all duration-300 group-hover:opacity-100 group-hover:scale-100 pointer-events-none group-hover:pointer-events-auto"
          >
            <a
              href="{% url 'accounts:login' %}"
              class="flex items-center gap-3 justify-center px-4 py-3 text-gray-800 dark:text-gray-200 bg-blue-50 dark:bg-blue-900 hover:bg-blue-100 dark:hover:bg-blue-800 rounded-t-xl font-semibold text-sm transition-all duration-200"
            >
              {% trans "ÙˆØ±ÙˆØ¯" %}
            </a>
            <a
              href="{% url 'accounts:register' %}"
              class="flex items-center gap-3 justify-center px-4 py-3 text-gray-800 dark:text-gray-200 bg-green-50 dark:bg-green-900 hover:bg-green-100 dark:hover:bg-green-800 rounded-b-xl font-semibold text-sm transition-all duration-200"
            >
              {% trans "Ø«Ø¨Øª Ù†Ø§Ù…" %}
            </a>
          </div>
          {% endif %}
        </div>

        <!-- Ø§Ù†ØªØ®Ø§Ø¨ Ø²Ø¨Ø§Ù† Ú©Ø´ÙˆÛŒÛŒ (Ø¯Ø³Ú©ØªØ§Ù¾) -->
        <div class="relative group">
          <button
            id="languageMenuButton"
            class="flex items-center gap-3 bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 px-4 py-2 rounded-lg focus:outline-none transition-all duration-300"
          >
            <span class="text-gray-800 dark:text-gray-200 font-medium">ğŸŒ Language</span>
            <svg
              class="w-5 h-5 transition-transform duration-300 group-hover:rotate-180"
              id="languageDropdownArrow"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
            </svg>
          </button>
          <div
            id="languageDropdown"
            class="absolute right-0 mt-2 w-56 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl shadow-2xl flex-col overflow-hidden opacity-0 scale-95 transform origin-top transition-all duration-300 group-hover:opacity-100 group-hover:scale-100 pointer-events-none group-hover:pointer-events-auto"
          >
            {% for code, name in LANGUAGES %}
              <form action="{% url 'set_language' %}" method="post" class="w-full">
                {% csrf_token %}
                <input name="next" type="hidden" value="{{ request.get_full_path }}" />
                <button
                  name="language"
                  value="{{ code }}"
                  type="submit"
                  class="w-full flex items-center gap-3 px-4 py-3 text-gray-800 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 transition-all duration-200"
                >
                  {{ name }}
                </button>
              </form>
            {% endfor %}
          </div>
        </div>

        <!-- Ø¯Ú©Ù…Ù‡ CTA Ø³Ø±ÛŒØ¹: Ø«Ø¨Øª Ø³ÙØ§Ø±Ø´ -->
        <a
          href="{% url 'shop:product_list' %}"
          class="bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-700 hover:to-blue-600 text-white px-6 py-3 rounded-full font-semibold shadow-md transition-all duration-300 hover:shadow-lg transform hover:-translate-y-1"
        >
          {% trans "ğŸ›’ Ø«Ø¨Øª Ø³ÙØ§Ø±Ø´" %}
        </a>
      </div>

      <!-- Ø¯Ú©Ù…Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„ -->
      <button
        id="mobile-menu-button"
        class="md:hidden focus:outline-none bg-gradient-to-r from-blue-600 to-blue-500 text-white p-3 rounded-full shadow-lg hover:shadow-xl transition-all duration-300"
      >
        <svg
          class="w-7 h-7"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            id="menu-icon"
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M4 6h16M4 12h16m-7 6h7"
          ></path>
        </svg>
      </button>
    </div>

    <!-- Ø±Ø¯ÛŒÙ Ù¾Ø§ÛŒÛŒÙ†: Ù…Ù†Ùˆ Ù†Ø§ÙˆØ¨Ø±ÛŒ (Ø¯Ø³Ú©ØªØ§Ù¾) -->
    <nav
      class="hidden md:flex items-center justify-center space-x-8 space-x-reverse text-gray-800 dark:text-gray-200 font-semibold border-t border-gray-200 dark:border-gray-700 py-3"
    >
      <a
        href="{% url 'shop:product_list' %}"
        class="relative group flex items-center gap-2 hover:text-blue-500 dark:hover:text-blue-400 transition-all duration-300"
      >
        ğŸ“¦ {% trans "Ù…Ø­ØµÙˆÙ„Ø§Øª" %}
        <span
          class="absolute bottom-0 left-0 w-0 h-0.5 bg-blue-500 dark:bg-blue-400 transition-all duration-300 group-hover:w-full"
        ></span>
      </a>
      <a
        href="{% url 'blog:blog_list' %}"
        class="relative group flex items-center gap-2 hover:text-blue-500 dark:hover:text-blue-400 transition-all duration-300"
      >
        ğŸ“° {% trans "ÙˆØ¨Ù„Ø§Ú¯" %}
        <span
          class="absolute bottom-0 left-0 w-0 h-0.5 bg-blue-500 dark:bg-blue-400 transition-all duration-300 group-hover:w-full"
        ></span>
      </a>
      <a
        href="{% url 'home:about' %}"
        class="relative group flex items-center gap-2 hover:text-blue-500 dark:hover:text-blue-400 transition-all duration-300"
      >
        â˜ï¸ {% trans "ØªÙ…Ø§Ø³ Ø¨Ø§ Ù…Ø§" %}
        <span
          class="absolute bottom-0 left-0 w-0 h-0.5 bg-blue-500 dark:bg-blue-400 transition-all duration-300 group-hover:w-full"
        ></span>
      </a>
      <a
        href="/static/catalog.pdf"
        target="_blank"
        class="relative group flex items-center gap-2 hover:text-blue-500 dark:hover:text-blue-400 transition-all duration-300"
      >
        ğŸ“– {% trans "Ú©Ø§ØªØ§Ù„ÙˆÚ¯" %}
        <span
          class="absolute bottom-0 left-0 w-0 h-0.5 bg-blue-500 dark:bg-blue-400 transition-all duration-300 group-hover:w-full"
        ></span>
      </a>
    </nav>
  </div>

  <!-- Ù…Ù†ÙˆÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„ -->
  <div
    id="mobile-menu"
    class="hidden fixed top-0 right-0 w-80 h-full overflow-y-auto bg-white dark:bg-gray-900 shadow-2xl border-l border-gray-200 dark:border-gray-700 z-40 transition-transform transform translate-x-full duration-300"
  >
    <div
      class="flex justify-between items-center px-6 py-5 border-b border-gray-200 dark:border-gray-700"
    >
      <span class="font-extrabold text-gray-900 dark:text-white text-lg">{% trans "Ù…Ù†Ùˆ" %}</span>
      <button id="close-menu" class="text-gray-500 dark:text-gray-300 hover:text-red-500 dark:hover:text-red-400 text-2xl transition-colors duration-300">
        &times;
      </button>
    </div>
    <nav
      class="flex flex-col items-start px-6 py-6 space-y-5 text-gray-800 dark:text-gray-200 font-semibold"
    >
      <a
        href="{% url 'shop:product_list' %}"
        class="hover:text-blue-500 dark:hover:text-blue-400 transition-all duration-300 flex items-center gap-3"
      >ğŸ“¦ {% trans "Ù…Ø­ØµÙˆÙ„Ø§Øª" %}</a>
      <a
        href="{% url 'blog:blog_list' %}"
        class="hover:text-blue-500 dark:hover:text-blue-400 transition-all duration-300 flex items-center gap-3"
      >ğŸ“° {% trans "ÙˆØ¨Ù„Ø§Ú¯" %}</a>
      <a
        href="{% url 'home:about' %}"
        class="hover:text-blue-500 dark:hover:text-blue-400 transition-all duration-300 flex items-center gap-3"
      >â˜ï¸ {% trans "ØªÙ…Ø§Ø³ Ø¨Ø§ Ù…Ø§" %}</a>

      <a
        href="/static/catalog.pdf"
        target="_blank"
        class="bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-700 hover:to-blue-600 text-white px-5 py-3 rounded-full transition-all duration-300 hover:shadow-lg transform hover:-translate-y-1 w-full text-center"
      >
        ğŸ“– {% trans "Ú©Ø§ØªØ§Ù„ÙˆÚ¯" %}
      </a>

      <!-- ÙØ±Ù… ÙˆØ±ÙˆØ¯/Ø«Ø¨Øª Ù†Ø§Ù… ÛŒØ§ Ø®Ø±ÙˆØ¬ Ù…ÙˆØ¨Ø§ÛŒÙ„ -->
      <div class="pt-5 border-t border-gray-200 dark:border-gray-700 w-full flex flex-col gap-3">
        {% if user.is_authenticated %}
        <span class="text-gray-800 dark:text-gray-200 font-semibold"
          >{% blocktrans %}Ø³Ù„Ø§Ù…ØŒ {{ user.username }}{% endblocktrans %}</span>
        <a
          href="{% url 'accounts:dashboard' %}"
          class="bg-blue-600 hover:bg-blue-500 text-white px-5 py-3 rounded-full transition-all duration-300 hover:shadow-lg transform hover:-translate-y-1 w-full text-center"
          >{% trans "Ù¾Ù†Ù„ Ú©Ø§Ø±Ø¨Ø±ÛŒ" %}</a>
        <form action="{% url 'accounts:logout' %}" method="post">
          {% csrf_token %}
          <button
            type="submit"
            class="bg-red-600 hover:bg-red-500 text-white px-5 py-3 rounded-full transition-all duration-300 hover:shadow-lg transform hover:-translate-y-1 w-full"
          >
            {% trans "Ø®Ø±ÙˆØ¬" %}
          </button>
        </form>
        {% else %}
        <a
          href="{% url 'accounts:login' %}"
          class="bg-blue-600 hover:bg-blue-500 text-white px-5 py-3 rounded-full transition-all duration-300 hover:shadow-lg transform hover:-translate-y-1 w-full text-center"
          >{% trans "ÙˆØ±ÙˆØ¯" %}</a>
        <a
          href="{% url 'accounts:register' %}"
          class="bg-green-600 hover:bg-green-500 text-white px-5 py-3 rounded-full transition-all duration-300 hover:shadow-lg transform hover:-translate-y-1 w-full text-center"
          >{% trans "Ø«Ø¨Øª Ù†Ø§Ù…" %}</a>
        {% endif %}
      </div>

      <!-- Ø§Ù†ØªØ®Ø§Ø¨ Ø²Ø¨Ø§Ù† Ù…ÙˆØ¨Ø§ÛŒÙ„ Ø¨Ø§ Ú©Ø´ÙˆÛŒÛŒ -->
      <div class="pt-5 border-t border-gray-200 dark:border-gray-700 w-full">
        <button
          id="mobileLanguageButton"
          class="w-full flex justify-between items-center px-5 py-3 text-gray-800 dark:text-gray-200 bg-gray-100 dark:bg-gray-800 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 font-semibold transition-all duration-300"
        >
          ğŸŒ Language / ØªØºÛŒÛŒØ± Ø²Ø¨Ø§Ù†
          <svg class="w-5 h-5 transition-transform duration-300" id="mobileLanguageArrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
          </svg>
        </button>
        <div id="mobileLanguageDropdown" class="hidden flex-col gap-3 mt-3">
          {% for code, name in LANGUAGES %}
            <form action="{% url 'set_language' %}" method="post" class="w-full">
              {% csrf_token %}
              <input name="next" type="hidden" value="{{ request.get_full_path }}" />
              <button
                name="language"
                value="{{ code }}"
                type="submit"
                class="px-4 py-2 text-sm bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-lg w-full text-center transition-all duration-300"
              >
                {{ name }}
              </button>
            </form>
          {% endfor %}
        </div>
      </div>
    </nav>
  </div>
</header>
<script>
  const menuButton = document.getElementById("mobile-menu-button");
  const mobileMenu = document.getElementById("mobile-menu");
  const closeMenu = document.getElementById("close-menu");
  const menuIcon = document.getElementById("menu-icon");

  menuButton.addEventListener("click", () => {
    mobileMenu.classList.toggle("hidden");
    mobileMenu.classList.toggle("translate-x-0");
    mobileMenu.classList.toggle("translate-x-full");
    menuIcon.setAttribute(
      "d",
      mobileMenu.classList.contains("translate-x-0")
        ? "M6 18L18 6M6 6l12 12"
        : "M4 6h16M4 12h16m-7 6h7"
    );
  });

  closeMenu.addEventListener("click", () => {
    mobileMenu.classList.add("translate-x-full");
    mobileMenu.classList.add("hidden");
    menuIcon.setAttribute("d", "M4 6h16M4 12h16m-7 6h7");
  });

  const header = document.getElementById("main-header");
  window.addEventListener("scroll", () => {
    if (window.scrollY > 50) {
      header.classList.add("shadow-lg", "py-2");
      header.classList.remove("py-3");
    } else {
      header.classList.remove("shadow-lg", "py-2");
      header.classList.add("py-3");
    }
  });

  function toggleDropdown(button, dropdown, arrow) {
    button.addEventListener("click", (e) => {
      e.stopPropagation();
      const isOpen = !dropdown.classList.contains("opacity-0");
      if (isOpen) {
        dropdown.classList.add("opacity-0", "scale-95", "pointer-events-none");
        dropdown.classList.remove("opacity-100", "scale-100", "pointer-events-auto");
        arrow.classList.remove("rotate-180");
      } else {
        dropdown.classList.remove("opacity-0", "scale-95", "pointer-events-none");
        dropdown.classList.add("opacity-100", "scale-100", "pointer-events-auto");
        arrow.classList.add("rotate-180");
      }
    });
  }

  const userMenuButton = document.getElementById("userMenuButton");
  const userDropdown = document.getElementById("userDropdown");
  const userDropdownArrow = document.getElementById("userDropdownArrow");

  if (userMenuButton && userDropdown && userDropdownArrow) {
    toggleDropdown(userMenuButton, userDropdown, userDropdownArrow);
  }

  const guestMenuButton = document.getElementById("guestMenuButton");
  const guestDropdown = document.getElementById("guestDropdown");
  const guestDropdownArrow = document.getElementById("guestDropdownArrow");

  if (guestMenuButton && guestDropdown && guestDropdownArrow) {
    toggleDropdown(guestMenuButton, guestDropdown, guestDropdownArrow);
  }

  const languageMenuButton = document.getElementById("languageMenuButton");
  const languageDropdown = document.getElementById("languageDropdown");
  const languageDropdownArrow = document.getElementById("languageDropdownArrow");

  if (languageMenuButton && languageDropdown && languageDropdownArrow) {
    toggleDropdown(languageMenuButton, languageDropdown, languageDropdownArrow);
  }

  window.addEventListener("click", () => {
    [userDropdown, guestDropdown, languageDropdown].forEach((dropdown) => {
      if (dropdown) {
        dropdown.classList.add("opacity-0", "scale-95", "pointer-events-none");
        dropdown.classList.remove("opacity-100", "scale-100", "pointer-events-auto");
      }
    });
    [userDropdownArrow, guestDropdownArrow, languageDropdownArrow].forEach((arrow) => {
      if (arrow) {
        arrow.classList.remove("rotate-180");
      }
    });
  });

  [userMenuButton, guestMenuButton, languageMenuButton].forEach((button) => {
    if (button) {
      button.addEventListener("click", (e) => e.stopPropagation());
    }
  });

  // Ù…ÙˆØ¨Ø§ÛŒÙ„: Ú©Ø´ÙˆÛŒÛŒ Ø²Ø¨Ø§Ù†
  const mobileLanguageButton = document.getElementById("mobileLanguageButton");
  const mobileLanguageDropdown = document.getElementById("mobileLanguageDropdown");
  const mobileLanguageArrow = document.getElementById("mobileLanguageArrow");

  if (mobileLanguageButton && mobileLanguageDropdown && mobileLanguageArrow) {
    mobileLanguageButton.addEventListener("click", (e) => {
      e.stopPropagation();
      mobileLanguageDropdown.classList.toggle("hidden");
      mobileLanguageArrow.classList.toggle("rotate-180");
    });
  }

  window.addEventListener("click", () => {
    if (mobileLanguageDropdown && !mobileLanguageDropdown.classList.contains("hidden")) {
      mobileLanguageDropdown.classList.add("hidden");
      mobileLanguageArrow.classList.remove("rotate-180");
    }
  });

  mobileLanguageDropdown.addEventListener("click", (e) => e.stopPropagation());

  // Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø²Ø¨Ø§Ù† Ù…Ø±ÙˆØ±Ú¯Ø± Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø®Ø§Ø±Ø¬ÛŒ
  document.addEventListener("DOMContentLoaded", () => {
    const userLang = navigator.language || navigator.userLanguage;
    const langCode = userLang.split("-")[0];
    const langButtons = document.querySelectorAll('#languageDropdown button, #mobileLanguageDropdown button[name="language"]');

    langButtons.forEach(btn => {
      if (btn.value === langCode) {
        btn.classList.add('bg-blue-100');
      }
    });
  });
</script>
