{% extends "base.html" %}
{% load widget_tweaks %}
{% load static %}
{% load custom_filters %}

{% block content %}
<section id="products" class="container mx-auto my-16 px-4 max-w-6xl animate-fadeIn">
  <h2 class="text-3xl md:text-4xl font-bold mb-12 text-center text-blue-800 drop-shadow-lg animate-slideUp">
    محصولات
  </h2>

  <!-- نوار فیلتر -->
  <form method="get" class="flex flex-wrap justify-center gap-4 mb-8">
    <select name="size" class="px-4 py-2 rounded-lg bg-gray-100 text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
      <option value="">همه سایزها</option>
      {% for s in sizes %}
      <option value="{{ s }}" {% if s == selected_size %}selected{% endif %}>{{ s }}</option>
      {% endfor %}
    </select>

    <select name="pressure" class="px-4 py-2 rounded-lg bg-gray-100 text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
      <option value="">همه بارها</option>
      {% for p in pressures %}
      <option value="{{ p }}" {% if p|stringformat:"s" == selected_pressure|stringformat:"s" %}selected{% endif %}>{{ p }} بار</option>
      {% endfor %}
    </select>

    <select name="pe_type" class="px-4 py-2 rounded-lg bg-gray-100 text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
      <option value="">همه نوع‌ها</option>
      {% for pe in pe_types %}
      <option value="{{ pe }}" {% if pe == selected_pe_type %}selected{% endif %}>{{ pe }}</option>
      {% endfor %}
    </select>

    <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-lg">فیلتر</button>
  </form>

  <div class="grid grid-cols-2 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">

    {% for product in products %}
    <div class="relative bg-white shadow-lg rounded-2xl overflow-hidden transform hover:scale-105 hover:shadow-2xl transition-all duration-300 animate-slideUp" style="animation-delay: {{ forloop.counter0|div:10 }}s;">
      <div class="relative">
        <img src="{{ product.image.url }}" class="w-full h-56 object-contain bg-gray-50 transition-transform duration-500 hover:scale-110" alt="{{ product.name }}" />
        <div class="absolute inset-0 bg-gradient-to-t from-black/20 to-transparent"></div>
      </div>
      <div class="p-6 text-center">
        <h3 class="font-semibold text-xl mb-3 text-blue-700">{{ product.name }}</h3>
        {% if product.description %}
        <p class="text-gray-600 text-sm mb-4 line-clamp-2">{{ product.description }}</p>
        {% endif %}

        <!-- مشخصات فنی -->
        <div class="flex justify-center gap-4 mb-4 text-sm text-gray-500">
          <div class="flex items-center gap-1">
            <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
            <span>{{ product.size }}</span>
          </div>
          <div class="flex items-center gap-1">
            <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
            <span>{{ product.pressure }} بار</span>
          </div>
          <div class="flex items-center gap-1">
            <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
            <span>{{ product.pe_type }}</span>
          </div>
        </div>

        <!-- دکمه ثبت سفارش -->
        <div class="flex justify-center gap-3">
          <a href="{% url 'orders:create_order' product.id %}" class="inline-block bg-gradient-to-r from-blue-600 to-blue-800 text-white px-5 py-2.5 rounded-lg hover:from-blue-700 hover:to-blue-900 transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50">
            ثبت سفارش
          </a>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
</section>


<!-- مودال مشاهده سریع -->
<div id="quickViewModal" class="fixed inset-0 bg-black/50 hidden flex items-center justify-center z-50">
  <div class="bg-white rounded-2xl p-6 max-w-lg w-full m-4 animate-slideUp">
    <h3 class="text-xl font-semibold text-blue-700 mb-4">جزئیات محصول</h3>
    <div id="quickViewContent" class="text-gray-600"></div>
    <button class="mt-4 bg-gray-200 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-300 transition-all duration-300" onclick="closeQuickView()">بستن</button>
  </div>
</div>

<script>
  function openQuickView(productId) {
    // اینجا باید از AJAX برای دریافت اطلاعات محصول استفاده کنید
    const modal = document.getElementById('quickViewModal');
    const content = document.getElementById('quickViewContent');
    content.innerHTML = `<p>در حال بارگذاری اطلاعات محصول ${productId}...</p>`;
    modal.classList.remove('hidden');
    // مثال: فراخوانی AJAX برای دریافت جزئیات
    // fetch(`/api/product/${productId}/`).then(response => response.json()).then(data => { content.innerHTML = data.details; });
  }

  function closeQuickView() {
    document.getElementById('quickViewModal').classList.add('hidden');
  }
</script>

<style>
  /* انیمیشن‌های سفارشی */
  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }
  .animate-fadeIn {
    animation: fadeIn 1s ease-in-out;
  }

  @keyframes slideUp {
    from { transform: translateY(20px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
  }
  .animate-slideUp {
    animation: slideUp 0.5s ease-out;
  }

  /* استایل‌های کارت محصولات */
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  /* ریسپانسیو برای موبایل، تبلت و دسکتاپ بزرگ */
  @media (max-width: 640px) { /* موبایل */
    .grid { grid-template-columns: repeat(3, 1fr); }
    h2 { font-size: 2rem; }
    .p-6 { padding: 1rem; }
    img { height: 10rem; }
    a, button { font-size: 0.85rem; padding: 0.5rem 1rem; }
    h3 { font-size: 1rem; }
    p, .text-sm { font-size: 0.8rem; }
    .gap-4 { gap: 0.5rem; }
  }

  @media (min-width: 641px) and (max-width: 1024px) { /* آیپد/تبلت */
    .grid { grid-template-columns: repeat(2, 1fr); }
    h2 { font-size: 2.5rem; }
    img { height: 14rem; }
  }

  @media (min-width: 1280px) { /* صفحه‌های بزرگ‌تر از دسکتاپ */
    .container { max-width: 7xl; }
    .grid { grid-template-columns: repeat(4, 1fr); gap: 2rem; }
    h2 { font-size: 3.5rem; }
    img { height: 16rem; }
  }
</style>
{% endblock content %}